name: Family Schedule Bot

on:
  schedule:
    - cron: '*/15 * * * *'  # 04:30 UTC –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  send-morning-notification:
    runs-on: ubuntu-latest
    
    steps:
      # –®–∞–≥ 1: Checkout –∫–æ–¥–∞
      - name: üì¶ Checkout code
        uses: actions/checkout@v4
      
      # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'  # –ö—ç—à–∏—Ä—É–µ–º pip –ø–∞–∫–µ—Ç—ã
      
      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ requirements.txt
      - name: üìö Install dependencies
        run: |
          echo "Installing dependencies from requirements.txt..."
          python -m pip install --upgrade pip
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ requirements.txt
          if [ -f "requirements.txt" ]; then
            echo "üìÑ Found requirements.txt:"
            cat requirements.txt
            pip install -r requirements.txt
          else
            echo "‚ùå requirements.txt not found!"
            exit 1
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
          echo "‚úÖ Installed packages:"
          pip list | grep -i "aiohttp"
      
      # –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
      - name: üîç Check project structure
        run: |
          echo "üìÅ Project structure:"
          echo "Current directory: $(pwd)"
          echo "Files:"
          ls -la
          echo ""
          echo "requirements.txt content:"
          cat requirements.txt
          echo ""
          echo "notifier.py exists: $([ -f "notifier.py" ] && echo "‚úÖ YES" || echo "‚ùå NO")"
      
      # –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
      - name: ü§ñ Run bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "üöÄ Running notifier.py..."
          python notifier.py
      
      # –®–∞–≥ 6: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      - name: üìù Log result
        if: always()
        run: |
          echo "=========================================="
          echo "üèÅ WORKFLOW COMPLETED: ${{ job.status }}"
          echo "üïê Finished at: $(date)"
          echo "üéØ Trigger: ${{ github.event_name }}"
          echo "üìÖ Next schedule: 04:30 UTC"
          echo "=========================================="
