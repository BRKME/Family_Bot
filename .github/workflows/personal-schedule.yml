name: Family Schedule Bot

on:
  schedule:
    - cron: '30 3 * * *'   # Утро 7:30 MSK
    - cron: '0 17 * * *'   # Вечер 20:00 MSK - благодарность
    - cron: '0 16 * * 5'   # Пятница 19:00 MSK - игры
  workflow_dispatch:

jobs:
  send-morning-notification:
    runs-on: ubuntu-latest
    if: github.event.schedule == '30 4 * * *' || github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          else
            pip install aiohttp
          fi
      
      - name: Run bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python notifier.py morning

  send-gratitude-reminder:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 17 * * *'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: pip install aiohttp
      
      - name: Run bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python notifier.py gratitude

  send-games-reminder:
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 16 * * 5'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: pip install aiohttp
      
      - name: Run bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python notifier.py games
